(function t(e,n,i){function r(a,s){if(!n[a]){if(!e[a]){var u=typeof require=="function"&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return r(n?n:t)},c,c.exports,t,e,n,i)}return n[a].exports}var o=typeof require=="function"&&require;for(var a=0;a<i.length;a++)r(i[a]);return r})({1:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("../models/Location/Location");var a=function(){function t(e,n){r(this,t);this.jmap=e;if(n.request)this.request=n.request;else this.request=this.boot.getRequest;if(n.DOMParser)this.xmlParser=n.DOMParser;else this.xmlParser=this.boot.getXMLParser()}i(t,[{key:"parseResponse",value:function e(t){this.jmap.location=new o(t.location);this.jmap.AmenityCollection.create(t.amenities);this.jmap.PathTypeCollection.create(t.pathTypes);this.jmap.CategoryCollection.create(t.categories);this.jmap.DestinationCollection.create(t.destinations);this.jmap.DeviceCollection.create(t.devices);this.jmap.MapCollection.create(t.maps);this.jmap.PathCollection.create(t.paths);this.jmap.ZoneCollection.create(t.zones);return this.attachWaypointsToCollections()}},{key:"extractAndSetSvgFrom",value:function n(t){return new Promise(function(e){var n=t.map(function(t){return new Promise(function(e){var n=null;if(t.bean){n=t.bean.filePath}else if(t.pathtypeUri){n=t.pathtypeUri[0]?t.pathtypeUri[0].filePath:null}if(!n){e(t)}else{e(t)}})});Promise.all(n).then(e)})}},{key:"attachWaypointsToCollections",value:function a(){var t=this;var e=1;var n=2;var i=26;var r=19;var o=this.jmap.MapCollection.getAllWaypoints();o.forEach(function(o){var a=o.AssociationCollection.getAll();a.forEach(function(a){var s=null;switch(a.entityTypeId){case e:s=t.jmap.DestinationCollection.getById(a.entityId);break;case n:s=t.jmap.DeviceCollection.getById(a.entityId);break;case i:s=t.jmap.AmenityCollection.getByComponentId(a.entityId);break;case r:break}if(s){if(s.waypoints.indexOf(o)===-1){s.waypoints.push(o)}}})})}},{key:"validateOptions",value:function s(t){try{t.server=this.validateProperty("server",t.server,String,null,true);t.locationId=this.validateProperty("locationId",t.locationId,Number,null,true);return t}catch(e){return e}}},{key:"validateProperty",value:function u(t,e,n,i,r){var o=new TypeError;if(e){if(e.constructor!==n){if(i&&!r){return i}else{o.message="Invalid: Cannot use "+e+" as "+t;throw o}}else{return e}}else{o.message="Invalid: Cannot use "+e+" as "+t;throw o}}},{key:"generateApi",value:function l(t){return t.server+"/v3/location/"+t.locationId+"/full"}},{key:"getRequest",value:function c(t,e){var n=new XMLHttpRequest;n.open("GET",t.url,true);for(var i in t.headers){if(t.headers.hasOwnProperty(i)){n.setRequestHeader(i,t.headers[i])}}n.onreadystatechange=function(){if(n.readyState==4&&n.status==200){if(n.status===200)e(null,n,n.responseText);else e("Status code: "+n.status,n,n.responseText)}};n.send()}},{key:"getXMLParser",value:function f(){var t=undefined;try{t=window.DOMParser}catch(e){t=null}return t}}]);return t}();e.exports=a},{"../models/Location/Location":16}],2:[function(t,e,n){"use strict";var i=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol?"symbol":typeof t};var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function o(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var a=t("./boot");var s=t("../models/Waypoint/Waypoint");var u=t("../models/Amenity/AmenityCollection");var l=t("../models/Category/CategoryCollection");var c=t("../models/Destination/DestinationCollection");var f=t("../models/Device/DeviceCollection");var h=t("../models/Event/EventCollection");var y=t("../models/Map/MapCollection");var v=t("../models/Path/PathCollection");var p=t("../models/PathType/PathTypeCollection");var d=t("../models/Zone/ZoneCollection");var g=t("../wayfinding/Wayfinder");var m=t("../text-directions/TextDirections");var k=t("../utility/Utility");var b=function(){function t(e){var n=this;o(this,t);this.boot=new a(this,e);this.options=this.boot.validateOptions(e);if(this.options.constructor===TypeError){e.onReady(this.options);return false}this.response={url:this.boot.generateApi(this.options),headers:this.options.headers};var i=this.boot.request;var r=this.boot.xmlParser;this.AmenityCollection=new u(r);this.CategoryCollection=new l;this.DestinationCollection=new c;this.DeviceCollection=new f;this.EventCollection=h;this.MapCollection=new y(r);this.PathCollection=new v;this.PathTypeCollection=new p;this.ZoneCollection=new d;i(this.response,function(t,i,r){if(!t){n.response.response=i;n.response.body=JSON.parse(r);n.boot.parseResponse(n.response.body);n.Wayfinder=new g(n);n.TextDirections=new m(n)}else{console.error(t)}if(e.onReady&&e.onReady.constructor===Function){e.onReady(t)}});t._items.push(this)}r(t,[{key:"getClosestWaypointInArrayToWaypoint",value:function e(t,n,i){var r={};if(!t||!t.length||!n||n.constructor!==s)return null;for(var o=0;o<t.length;o++){var a=t[o];if(a.constructor!==s)continue;if(n.id===a.id)continue;var u=this.Wayfinder.search(n,a,i);var l=undefined;if(u[u.length-1])l=u[u.length-1].cost;if(!r.cost||r.cost>l){r.cost=l;r.wp=a}}return r.wp||null}},{key:"getClosestDestinationToWaypoint",value:function n(t,e,r){var o=this;if(t.constructor===s){var a=function(){var n=o;e=e&&e.constructor===Function?e:function(){return true};var i=o.MapCollection.getWaypointsWithDestination().filter(function(t){return n.DestinationCollection.getByWaypointId(t.id).filter(e)[0]});var a=o.getClosestWaypointInArrayToWaypoint(i,t,r);return{v:{destination:o.DestinationCollection.getByWaypointId(a.id).filter(e)[0],waypoint:a}}}();if((typeof a==="undefined"?"undefined":i(a))==="object")return a.v}else{return null}}},{key:"getClosestAmenityToWaypoint",value:function k(t,e,n){var r=this;if(t.constructor===s){var o=function(){var i=r;e=e&&e.constructor===Function?e:function(){return true};var o=r.MapCollection.getWaypointsWithAmenity().filter(function(t){return i.AmenityCollection.getByWaypointId(t.id).filter(e)[0]});var a=r.getClosestWaypointInArrayToWaypoint(o,t,n);return{v:{amenity:r.AmenityCollection.getByWaypointId(a.id).filter(e)[0],waypoint:a}}}();if((typeof o==="undefined"?"undefined":i(o))==="object")return o.v}else{return null}}}]);return t}();b.util=new k;b._items=[];(function(t){try{window.JMap=t}catch(n){e.exports=t}})(b)},{"../models/Amenity/AmenityCollection":4,"../models/Category/CategoryCollection":8,"../models/Destination/DestinationCollection":10,"../models/Device/DeviceCollection":14,"../models/Event/EventCollection":15,"../models/Map/MapCollection":18,"../models/Path/PathCollection":22,"../models/PathType/PathTypeCollection":24,"../models/Waypoint/Waypoint":25,"../models/Zone/ZoneCollection":28,"../text-directions/TextDirections":30,"../utility/Utility":40,"../wayfinding/Wayfinder":46,"./boot":1}],3:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(e,n){r(this,t);this._={waypoints:[]};for(var i in e.bean){if(e.bean.hasOwnProperty(i)){this._[i]=e.bean[i];if(i==="filePath"&&i.indexOf(".svg")){try{if(this._.svg){this._.svg=this._.svg.replace(/\r\n|\r|\n|\t/g,"");this._.svg=this._.svg.replace(/\s+/g," ");this._.svgTree=(new n).parseFromString(this._.svg,"text/xml");if(!this._.svgTree||!this._.svgTree.documentElement||this._.svgTree.documentElement.nodeName=="parsererror"){throw new TypeError("Amenity :: input contains invalid XML data")}}}catch(o){throw o}}}}}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}},{key:"componentId",get:function o(){return this.get("componentId",null)},set:function a(t){this.set("componentId",t,Number,null)}},{key:"componentTypeId",get:function s(){return this.get("componentTypeId",null)},set:function u(t){this.set("componentTypeId",t,Number,null)}},{key:"componentTypeName",get:function l(){return this.get("componentTypeName","")},set:function c(t){this.set("componentTypeName",t,String,"")}},{key:"description",get:function f(){return this.get("description","")},set:function h(t){this.set("description",t,String,"")}},{key:"destinations",get:function y(){return this.get("destinations",[])},set:function v(t){this.set("destinations",t,Array,[])}},{key:"endDate",get:function p(){return this.get("endDate",null)},set:function d(t){this.set("endDate",t,Number,null)}},{key:"filePath",get:function g(){return this.get("filePath","")},set:function m(t){this.set("filePath",t,String,"")}},{key:"iconImagePath",get:function k(){return this.get("iconImagePath","")},set:function b(t){this.set("iconImagePath",t,String,"")}},{key:"localizedText",get:function w(){return this.get("localizedText","")},set:function I(t){this.set("localizedText",t,String,"")}},{key:"position",get:function T(){return this.get("position","")},set:function x(t){this.set("position",t,String,"")}},{key:"projectId",get:function _(){return this.get("projectId",null)},set:function C(t){this.set("projectId",t,Number,null)}},{key:"startDate",get:function D(){return this.get("startDate",null)},set:function P(t){this.set("startDate",t,Number,null)}},{key:"waypoints",get:function A(){return this.get("waypoints",[])},set:function M(t){this.set("waypoints",t,Array,[])}}]);return t}();e.exports=o},{}],4:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./Amenity");var a=function(){function t(e){r(this,t);this._items=[];if(e){this.DOMParser=e}else{throw new TypeError("AmenityCollection :: No XML parser provided. Amenity.svgTree will not be available")}}i(t,[{key:"isAmenity",value:function e(t){return t&&t.constructor===o}},{key:"create",value:function n(t){var e=this;var n=null;if(t){if(t.constructor===Array){n=t.map(function(t){return new o(t,e.DOMParser)});this._items=this._items.concat(n)}else if(t.constructor===Object){n=new o(t,this.DOMParser);this._items.push(n)}}return n}},{key:"getAll",value:function a(){return this._items}},{key:"getByComponentId",value:function s(t){return this._items.find(function(e){return e.componentId===t})||null}},{key:"getByMapId",value:function u(t){return this._items.filter(function(e){return e.waypoints.find(function(e){return e.mapId===t})})}},{key:"getByWaypointId",value:function l(t){return this._items.filter(function(e){return e.waypoints.find(function(e){return e.id===t})})}}]);return t}();e.exports=a},{"./Amenity":3}],5:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(e){r(this,t);this._={};for(var n in e){if(e.hasOwnProperty(n)){this._[n]=e[n]}}}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}},{key:"entityId",get:function o(){return this.get("entityId",null)},set:function a(t){this.set("entityId",t,Number,null)}},{key:"entityTypeId",get:function s(){return this.get("entityTypeId",null)},set:function u(t){this.set("entityTypeId",t,Number,null)}},{key:"landmarkRating",get:function l(){return this.get("landmarkRating",null)},set:function c(t){this.set("landmarkRating",t,Number,null)}},{key:"waypointId",get:function f(){return this.get("waypointId",null)},set:function h(t){this.set("waypointId",t,Number,null)}}]);return t}();e.exports=o},{}],6:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./Association");var a=function(){function t(){r(this,t);this._items=[]}i(t,[{key:"isAssociation",value:function e(t){return t&&t.constructor===o}},{key:"create",value:function n(t){var e=null;if(t){if(t.constructor===Array){e=t.map(function(t){return new o(t)});this._items=this._items.concat(e)}else if(t.constructor===Object){e=new o(t);this._items.push(e)}}return e}},{key:"getAll",value:function a(){return this._items}},{key:"getByEntityId",value:function s(t){return this._items.filter(function(e){return e.entityId===t})}},{key:"getByEntityTypeId",value:function u(t){return this._items.filter(function(e){return e.entityTypeId===t})}}]);return t}();e.exports=a},{"./Association":5}],7:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(e){r(this,t);this._={};for(var n in e){if(e.hasOwnProperty(n)){this._[n]=e[n]}}}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}},{key:"categoryType",get:function o(){return this.get("categoryType",null)},set:function a(t){this.set("categoryType",t,Number,null)}},{key:"categoryTypeName",get:function s(){return this.get("categoryTypeName","")},set:function u(t){this.set("categoryTypeName",t,String,"")}},{key:"clientCategoryId",get:function l(){return this.get("clientCategoryId","")},set:function c(t){this.set("clientCategoryId",t,String,"")}},{key:"id",get:function f(){return this.get("id",null)},set:function h(t){this.set("id",t,Number,null)}},{key:"keywords",get:function y(){return this.get("keywords","")},set:function v(t){this.set("keywords",t,String,"")}},{key:"name",get:function p(){return this.get("name","")},set:function d(t){this.set("name",t,String,"")}},{key:"parent",get:function g(){return this.get("parent",null)},set:function m(t){this.set("parent",t,Number,null)}},{key:"projectId",get:function k(){return this.get("projectId",null)},set:function b(t){this.set("projectId",t,Number,null)}},{key:"text",get:function w(){return this.get("text","")},set:function I(t){this.set("text",t,String,"")}}]);return t}();e.exports=o},{}],8:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./Category");var a=function(){function t(){r(this,t);this._items=[]}i(t,[{key:"isCategory",value:function e(t){return t&&t.constructor===o}},{key:"create",value:function n(t){var e=null;if(t){if(t.constructor===Array){e=t.map(function(t){return new o(t)});this._items=this._items.concat(e)}else if(t.constructor===Object){e=new o(t);this._items.push(e)}}return e}},{key:"getAll",value:function a(){return this._items}},{key:"getByCategoryType",value:function s(t){return this._items.filter(function(e){return e.categoryType===t})}},{key:"getByCategoryTypeName",value:function u(t){return this._items.filter(function(e){return e.categoryTypeName===t})}},{key:"getByClientCategoryId",value:function l(t){return this._items.filter(function(e){return e.clientCategoryId===t})}},{key:"getByKeyword",value:function c(t){if(t&&t.constructor===String){return this._items.filter(function(e){return e.keywords.toLowerCase().indexOf(t.toLowerCase())>-1})}else{return[]}}},{key:"getByName",value:function f(t){if(t&&t.constructor===String){return this._items.find(function(e){return e.name.toLowerCase()===t.toLowerCase()})||null}else{return null}}},{key:"getById",value:function h(t){return this._items.find(function(e){return e.id===t})||null}}]);return t}();e.exports=a},{"./Category":7}],9:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(e){r(this,t);this._={waypoints:[]};for(var n in e){if(e.hasOwnProperty(n)){this._[n]=e[n]}}}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}},{key:"category",get:function o(){return this.get("category",[])},set:function a(t){this.set("category",t,Array,[])}},{key:"categoryId",get:function s(){return this.get("categoryId",[])},set:function u(t){this.set("categoryId",t,Array,[])}},{key:"clientId",get:function l(){return this.get("clientId","")},set:function c(t){this.set("clientId",t,String,"")}},{key:"description",get:function f(){return this.get("description","")},set:function h(t){this.set("description",t,String,"")}},{key:"descriptionMore",get:function y(){return this.get("descriptionMore","")},set:function v(t){this.set("descriptionMore",t,String,"")}},{key:"helperImage",get:function p(){return this.get("helperImage","")},set:function d(t){this.set("helperImage",t,String,"")}},{key:"id",get:function g(){return this.get("id",null)},set:function m(t){this.set("id",t,Number,null)}},{key:"keywords",get:function k(){return this.get("keywords","")},set:function b(t){this.set("keywords",t,String,"")}},{key:"name",get:function w(){return this.get("name","")},set:function I(t){this.set("name",t,String,"")}},{key:"openingDate",get:function T(){return this.get("openingDate",null)},set:function x(t){this.set("openingDate",t,Number,null)}},{key:"operatingStatus",get:function _(){return this.get("operatingStatus",null)},set:function C(t){this.set("operatingStatus",t,Number,null)}},{key:"projectId",get:function D(){return this.get("projectId",null)},set:function P(t){this.set("projectId",t,Number,null)}},{key:"qrCodeImage",get:function A(){return this.get("qrCodeImage",null)},set:function M(t){this.set("qrCodeImage",t,String,null)}},{key:"sponsoredRating",get:function N(){return this.get("sponsoredRating",null)},set:function S(t){this.set("sponsoredRating",t,Number,null)}},{key:"waypoints",get:function F(){return this.get("waypoints",[])},set:function B(t){this.set("waypoints",t,Array,[])}}]);return t}();e.exports=o},{}],10:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./Destination");var a=t("../Waypoint/Waypoint");var s=function(){function t(){r(this,t);this._items=[]}i(t,[{key:"isDestination",value:function e(t){return t&&t.constructor===o}},{key:"create",value:function n(t){var e=null;if(t){if(t.constructor===Array){e=t.map(function(t){return new o(t)});this._items=this._items.concat(e)}else if(t.constructor===Object){e=new o(t);this._items.push(e)}}return e}},{key:"getAll",value:function s(){return this._items}},{key:"getById",value:function u(t){return this._items.find(function(e){return e.id===t})||null}},{key:"getByClientId",value:function l(t){return this._items.find(function(e){return e.clientId===t})||null}},{key:"getByMapId",value:function c(t){return this._items.filter(function(e){return e.waypoints.find(function(e){return e.mapId===t})})}},{key:"getByWaypointId",value:function f(t){return this._items.filter(function(e){return e.waypoints.find(function(e){return e.id===t})})}},{key:"getByZoneId",value:function h(t){return this._items.filter(function(e){return e.waypoints.find(function(e){return e.zoneId===t})})}},{key:"getByCategoryId",value:function y(t){return this._items.filter(function(e){return e.categoryId.find(function(e){return e===t})})}},{key:"getByKeyword",value:function v(t){if(t&&t.constructor===String){return this._items.filter(function(e){return e.keywords.toLowerCase().indexOf(t.toLowerCase())>-1})}else{return[]}}},{key:"getByOperatingStatus",value:function p(t){return this._items.filter(function(e){return e.operatingStatus===t})}},{key:"getBySponsoredRating",value:function d(t){return this._items.filter(function(e){return e.sponsoredRating===t})}},{key:"sortBySponsoredRating",value:function g(t){if(t&&t.constructor===Array){t.forEach(function(t){if(t.constructor!==o){throw new TypeError("JMap : All items must be type Destination")}})}else{t=this._items}return t.sort(function(t,e){return t.sponsoredRating<e.sponsoredRating?1:e.sponsoredRating<t.sponsoredRating?-1:0})}},{key:"getHighestSponsoredDestinationByWaypoint",value:function m(t){var e=this;if(t&&t.constructor===a){var n=t.AssociationCollection.getByEntityTypeId(1);var i=n.map(function(t){return e.getById(t.entityId)});return this.sortBySponsoredRating(i)[0]||null}else{return null}}}]);return t}();e.exports=s},{"../Waypoint/Waypoint":25,"./Destination":9}],11:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(e){r(this,t);this._={};for(var n in e){if(e.hasOwnProperty(n)){this._[n]=e[n]}}}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}}]);return t}();e.exports=o},{}],12:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./DestinationLabel");var a=function(){function t(){r(this,t);this._items=[]}i(t,[{key:"isDestinationLabel",value:function e(t){return t&&t.constructor===o}},{key:"create",value:function n(t){var e=null;if(t){if(t.constructor===Array){e=t.map(function(t){return new o(t)});this._items=this._items.concat(e)}else if(t.constructor===Object){e=new o(t);this._items.push(e)}}return e}},{key:"getAll",value:function a(){return this._items}}]);return t}();e.exports=a},{"./DestinationLabel":11}],13:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(e){r(this,t);this._={waypoints:[]};for(var n in e){if(e.hasOwnProperty(n)){this._[n]=e[n]}}}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}},{key:"description",get:function o(){return this.get("description","")},set:function a(t){this.set("description",t,String,"")}},{key:"deviceTypeDescription",get:function s(){return this.get("deviceTypeDescription","")},set:function u(t){this.set("deviceTypeDescription",t,String,"")}},{key:"deviceTypeId",get:function l(){return this.get("deviceTypeId",null)},set:function c(t){this.set("deviceTypeId",t,Number,null)}},{key:"heading",get:function f(){return this.get("heading","")},set:function h(t){this.set("heading",t,String,"")}},{key:"id",get:function y(){return this.get("id",null)},set:function v(t){this.set("id",t,Number,null)}},{key:"projectId",get:function p(){return this.get("projectId",null)},set:function d(t){this.set("projectId",t,Number,null)}},{key:"status",get:function g(){return this.get("status","")},set:function m(t){this.set("status",t,String,"")}},{key:"waypoints",get:function k(){return this.get("waypoints",[])},set:function b(t){this.set("waypoints",t,Array,[])}}]);return t}();e.exports=o},{}],14:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./Device");var a=function(){function t(){r(this,t);this._items=[]}i(t,[{key:"isDevice",value:function e(t){return t&&t.constructor===o}},{key:"create",value:function n(t){var e=null;if(t){if(t.constructor===Array){e=t.map(function(t){return new o(t)});this._items=this._items.concat(e)}else if(t.constructor===Object){e=new o(t);this._items.push(e)}}return e}},{key:"getAll",value:function a(){return this._items}},{key:"getById",value:function s(t){return this._items.find(function(e){return e.id===t})||null}},{key:"getByMapId",value:function u(t){return this._items.filter(function(e){return e.waypoints.find(function(e){return e.mapId===t})})}},{key:"getByWaypointId",value:function l(t){return this._items.filter(function(e){return e.waypoints.find(function(e){return e.id===t})})}},{key:"getByDeviceTypeId",value:function c(t){return this._items.filter(function(e){return e.deviceTypeId===t})}},{key:"getByStatus",value:function f(t){if(t&&t.constructor===String){return this._items.filter(function(e){return e.status.toLowerCase()===t.toLowerCase()})}else{return[]}}}]);return t}();e.exports=a},{"./Device":13}],15:[function(t,e,n){"use strict"},{}],16:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(e){r(this,t);this._={};for(var n in e){if(e.hasOwnProperty(n)){this._[n]=e[n]}}}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}},{key:"addresses",get:function o(){return this.get("addresses",[])},set:function a(t){this.set("addresses",t,Array,[])}},{key:"clientProjectId",get:function s(){return this.get("clientProjectId","")},set:function u(t){this.set("clientProjectId",t,String,[])}},{key:"languages",get:function l(){return this.get("languages",[])},set:function c(t){this.set("languages",t,Array,[])}},{key:"locationId",get:function f(){return this.get("locationId",null)},set:function h(t){this.set("locationId",t,Number,null)}},{key:"locationName",get:function y(){return this.get("locationName","")},set:function v(t){this.set("locationName",t,String,"")}},{key:"name",get:function p(){return this.get("name","")},set:function d(t){this.set("name",t,String,"")}},{key:"projectId",get:function g(){return this.get("projectId",null)},set:function m(t){this.set("projectId",t,Number,null)}},{key:"status",get:function k(){return this.get("status","")},set:function b(t){this.set("status",t,String,"")}}]);return t}();e.exports=o},{}],17:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("../Waypoint/WaypointCollection");var a=t("../DestinationLabel/DestinationLabelCollection");var s=t("../MapLabel/MapLabelCollection");var u=function(){function t(e,n){r(this,t);this._={};for(var i in e){if(e.hasOwnProperty(i)){if(i=="map"){var u=e[i];for(var l in u){if(u.hasOwnProperty(l)){this._[l]=u[l]}}}else if(i=="waypoints"){this.WaypointCollection=new o;this.WaypointCollection.create(e[i])}else if(i=="destinationLabels"){this.DestinationLabelCollection=new a;this.DestinationLabelCollection.create(e[i])}else if(i=="mapLabels"){this.MapLabelCollection=new s;this.MapLabelCollection.create(e[i])}else if(i=="svg"&&e[i]&&n){try{e[i]=e[i].replace(/\r\n|\r|\n|\t/g,"");e[i]=e[i].replace(/\s+/g," ");this._.svgTree=(new n).parseFromString(e[i],"text/xml");if(!this._.svgTree.documentElement||this._.svgTree.documentElement.nodeName=="parsererror"){throw new TypeError("Map :: input contains invalid XML data")}else{this._[i]=e[i]}var c=this._.svgTree.documentElement.getElementsByTagName("rect");this._.lboxes=[];for(var f=0;f<c.length;f++){var h=c[f].getAttribute("class");if(h==="LBox")this._.lboxes.push(c[f])}var y=this._.svgTree.getElementsByTagName("svg")[0].childNodes;for(var v=0;v<y.length;v++){var p=y[v].getAttribute("id");if(p){var d=p.replace(/_.*/,"");if(d){y[v].setAttribute("name",d);y[v].setAttribute("class",d+"-Layer")}}}}catch(g){throw g}}else{this._[i]=e[i]}}}}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}},{key:"getWaypointsInArea",value:function u(t,e){if(!t||!t.x||!t.y||t.x.constructor!==Number||t.y.constructor!==Number){throw new TypeError("Map :: first argument by be valid {x: Number, y: Number}")}if(!e||e!==Number)e=100;var n=Math.pow(e,2);var i=[];var r=this.WaypointCollection;r.getAll().forEach(function(e){var r=Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2);if(r<n){i.push({id:e.id,distance:Math.sqrt(r)})}});return i.sort(function(t,e){return t.distance-e.distance}).map(function(t){return r.getById(t.id)})}},{key:"WaypointCollection",get:function l(){return this.get("WaypointCollection",null)},set:function c(t){this.set("WaypointCollection",t,o,null);
}},{key:"DestinationLabelCollection",get:function f(){return this.get("DestinationLabelCollection",null)},set:function h(t){this.set("DestinationLabelCollection",t,a,null)}},{key:"MapLabelCollection",get:function y(){return this.get("MapLabelCollection",null)},set:function v(t){this.set("MapLabelCollection",t,s,null)}},{key:"destinationLabels",get:function p(){return this.get("destinationLabels",[])},set:function d(t){this.set("destinationLabels",t,Array,[])}},{key:"defaultMapForDevice",get:function g(){return this.get("defaultMapForDevice",false)},set:function m(t){this.set("defaultMapForDevice",t,Boolean,false)}},{key:"description",get:function k(){return this.get("description","")},set:function b(t){this.set("description",t,String,"")}},{key:"floorSequence",get:function w(){return this.get("floorSequence",null)},set:function I(t){this.set("floorSequence",t,Number,null)}},{key:"locationId",get:function T(){return this.get("locationId",null)},set:function x(t){this.set("locationId",t,Number,null)}},{key:"locationName",get:function _(){return this.get("locationName","")},set:function C(t){this.set("locationName",t,String,"")}},{key:"mapId",get:function D(){return this.get("mapId",null)},set:function P(t){this.set("mapId",t,Number,null)}},{key:"name",get:function A(){return this.get("name","")},set:function M(t){this.set("name",t,String,"")}},{key:"parentLocationId",get:function N(){return this.get("parentLocationId",null)},set:function S(t){this.set("parentLocationId",t,Number,null)}},{key:"preference",get:function F(){return this.get("preference",null)},set:function B(t){this.set("preference",t,Number,null)}},{key:"status",get:function L(){return this.get("status",null)},set:function W(t){this.set("status",t,Number,null)}},{key:"statusDesc",get:function O(){return this.get("statusDesc","")},set:function j(t){this.set("statusDesc",t,String,"")}},{key:"svgMap",get:function E(){return this.get("svgMap","")},set:function q(t){this.set("svgMap",t,String,"")}},{key:"thumbnailHTML",get:function R(){return this.get("thumbnailHTML","")},set:function z(t){this.set("thumbnailHTML",t,String,"")}},{key:"uri",get:function U(){return this.get("uri","")},set:function Z(t){this.set("uri",t,String,"")}},{key:"xOffset",get:function X(){return this.get("xOffset",null)},set:function H(t){this.set("xOffset",t,Number,null)}},{key:"xScale",get:function G(){return this.get("xScale",null)},set:function V(t){this.set("xScale",t,Number,null)}},{key:"yOffset",get:function Y(){return this.get("yOffset",null)},set:function K(t){this.set("yOffset",t,Number,null)}},{key:"yScale",get:function J(){return this.get("yScale",null)},set:function Q(t){this.set("yScale",t,Number,null)}},{key:"mapLabels",get:function $(){return this.get("mapLabels",[])},set:function tt(t){this.set("mapLabels",t,Array,[])}},{key:"svg",get:function et(){return this.get("svg","")},set:function nt(t){this.set("svg",t,String,"")}},{key:"svgTree",get:function it(){var t=this.get("svgTree",null);return t}},{key:"lboxes",get:function rt(){return this.get("lboxes",[])}},{key:"waypoints",get:function ot(){return this.get("waypoints",[])},set:function at(t){this.set("waypoints",t,Array,[])}}]);return t}();e.exports=u},{"../DestinationLabel/DestinationLabelCollection":12,"../MapLabel/MapLabelCollection":20,"../Waypoint/WaypointCollection":26}],18:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./Map");var a=t("../Waypoint/Waypoint");var s=function(){function t(e){r(this,t);this._items=[];if(e){this.DOMParser=e}else{throw new TypeError("MapCollection :: No XML parser provided. Map.svgTree & Text Directions will not be available")}}i(t,[{key:"isMap",value:function e(t){return t&&t.constructor===o}},{key:"isWaypoint",value:function n(t){return t&&t.constructor===a}},{key:"create",value:function s(t){var e=this;var n=null;if(t){if(t.constructor===Array){n=t.map(function(t){return new o(t,e.DOMParser)});this._items=this._items.concat(n)}else if(t.constructor===Object){n=new o(t,this.DOMParser);this._items.push(n)}}return n}},{key:"getAll",value:function u(){return this._items}},{key:"getByFloorSequence",value:function l(t){return this._items.find(function(e){return e.floorSequence===t})||null}},{key:"getByLocationId",value:function c(t){return this._items.find(function(e){return e.locationId===t})||null}},{key:"getByMapId",value:function f(t){return this._items.find(function(e){return e.mapId===t})||null}},{key:"getByDestinationId",value:function h(t){var e=this;var n=this.getWaypointsByDestinationId(t);return n.map(function(t){return e.getByMapId(t.mapId)})}},{key:"getWaypointsByMapId",value:function y(t){var e=this.getByMapId(t);return e&&e.WaypointCollection?e.WaypointCollection.getAll():[]}},{key:"getAllWaypoints",value:function v(){return this._items.reduce(function(t,e){return e&&e.WaypointCollection?t.concat(e.WaypointCollection.getAll()):t},[])}},{key:"getWaypointsWithDestination",value:function p(){return this.getAllWaypoints().filter(function(t){return t.AssociationCollection.getByEntityTypeId(1).length})}},{key:"getWaypointsWithAmenity",value:function d(){return this.getAllWaypoints().filter(function(t){return t.AssociationCollection.getByEntityTypeId(26).length})}},{key:"getWaypointByWaypointId",value:function g(t){return this.getAllWaypoints().find(function(e){return e.id===t})||null}},{key:"getWaypointsByDestinationId",value:function m(t){return this.getAllWaypoints().filter(function(e){return e.AssociationCollection.getAll().find(function(e){return e.entityId===t})})}},{key:"getMapLabelsByMapId",value:function k(t){var e=this.getByMapId(t);return e&&e.MapLabelCollection?e.MapLabelCollection.getAll():[]}},{key:"getAllMapLabels",value:function b(){return this._items.reduce(function(t,e){return e&&e.MapLabelCollection?t.concat(e.MapLabelCollection.getAll()):t},[])}},{key:"getDestinationLabelsByMapId",value:function w(t){var e=this.getByMapId(t);return e&&e.DestinationLabelCollection?e.DestinationLabelCollection.getAll():[]}},{key:"getAllDestinationLabels",value:function I(){return this._items.reduce(function(t,e){return e&&e.DestinationLabelCollection?t.concat(e.DestinationLabelCollection.getAll()):t},[])}}]);return t}();e.exports=s},{"../Waypoint/Waypoint":25,"./Map":17}],19:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(e){r(this,t);this._={};for(var n in e){if(e.hasOwnProperty(n)){this._[n]=e[n]}}}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}},{key:"ck",get:function o(){return this.get("ck","")},set:function a(t){this.set("ck",t,String,"")}},{key:"componentId",get:function s(){return this.get("componentId",null)},set:function u(t){this.set("componentId",t,Number,null)}},{key:"componentTypeName",get:function l(){return this.get("componentTypeName","")},set:function c(t){this.set("componentTypeName",t,String,"")}},{key:"description",get:function f(){return this.get("description","")},set:function h(t){this.set("description",t,String,"")}},{key:"label",get:function y(){return this.get("label","")},set:function v(t){this.set("label",t,String,"")}},{key:"localizedText",get:function p(){return this.get("localizedText","")},set:function d(t){this.set("localizedText",t,String,"")}},{key:"locationId",get:function g(){return this.get("locationId",null)},set:function m(t){this.set("locationId",t,Number,null)}},{key:"locationX",get:function k(){return this.get("locationX","")},set:function b(t){this.set("locationX",t,String,"")}},{key:"locationY",get:function w(){return this.get("locationY","")},set:function I(t){this.set("locationY",t,String,"")}},{key:"mapId",get:function T(){return this.get("mapId",null)},set:function x(t){this.set("mapId",t,Number,null)}},{key:"projectId",get:function _(){return this.get("projectId",null)},set:function C(t){this.set("projectId",t,Number,null)}},{key:"rotation",get:function D(){return this.get("rotation","")},set:function P(t){this.set("rotation",t,String,"")}},{key:"typeId",get:function A(){return this.get("typeId",null)},set:function M(t){this.set("typeId",t,Number,null)}},{key:"zoomlevel",get:function N(){return this.get("zoomlevel",null)},set:function S(t){this.set("zoomlevel",t,Number,null)}}]);return t}();e.exports=o},{}],20:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./MapLabel");var a=function(){function t(){r(this,t);this._items=[]}i(t,[{key:"isMapLabel",value:function e(t){return t&&t.constructor===o}},{key:"create",value:function n(t){var e=null;if(t){if(t.constructor===Array){e=t.map(function(t){return new o(t)});this._items=this._items.concat(e)}else if(t.constructor===Object){e=new o(t);this._items.push(e)}}return e}},{key:"getAll",value:function a(){return this._items}}]);return t}();e.exports=a},{"./MapLabel":19}],21:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(e){r(this,t);this._={};for(var n in e){if(e.hasOwnProperty(n)){this._[n]=e[n]}}}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}},{key:"defaultWeight",get:function o(){return this.get("defaultWeight",false)},set:function a(t){this.set("defaultWeight",t,Boolean,false)}},{key:"direction",get:function s(){return this.get("direction",null)},set:function u(t){this.set("direction",t,Number,null)}},{key:"id",get:function l(){return this.get("id",null)},set:function c(t){this.set("id",t,Number,null)}},{key:"localId",get:function f(){return this.get("localId",null)},set:function h(t){this.set("localId",t,Number,null)}},{key:"name",get:function y(){return this.get("name","")},set:function v(t){this.set("name",t,String,"")}},{key:"status",get:function p(){return this.get("status",null)},set:function d(t){this.set("status",t,Number,null)}},{key:"type",get:function g(){return this.get("type",null)},set:function m(t){this.set("type",t,Number,null)}},{key:"waypoints",get:function k(){return this.get("waypoints",[])},set:function b(t){this.set("waypoints",t,Array,[])}},{key:"weight",get:function w(){return this.get("weight",null)},set:function I(t){this.set("weight",t,Number,null)}}]);return t}();e.exports=o},{}],22:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./Path");var a=function(){function t(){r(this,t);this._items=[]}i(t,[{key:"isPath",value:function e(t){return t&&t.constructor===o}},{key:"create",value:function n(t){var e=null;if(t){if(t.constructor===Array){e=t.map(function(t){return new o(t)});this._items=this._items.concat(e)}else if(t.constructor===Object){e=new o(t);this._items.push(e)}}return e}},{key:"getAll",value:function a(){return this._items}},{key:"getByDirection",value:function s(t){return this._items.filter(function(e){return e.direction===t})}},{key:"getById",value:function u(t){return this._items.find(function(e){return e.id===t})||null}},{key:"getByName",value:function l(t){if(t&&t.constructor===String){return this._items.find(function(e){return e.name.toLowerCase()==t.toLowerCase()})||null}else{return null}}},{key:"getByStatus",value:function c(t){return this._items.filter(function(e){return e.status===t})}},{key:"getByType",value:function f(t){return this._items.filter(function(e){return e.type===t})}},{key:"getByWaypointId",value:function h(t){return this._items.filter(function(e){return e.waypoints.find(function(e){return e===t})})}},{key:"getByWeight",value:function y(t){return this._items.filter(function(e){return e.weight===t})}}]);return t}();e.exports=a},{"./Path":21}],23:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(e){r(this,t);this._={};for(var n in e){if(e.hasOwnProperty(n)){this._[n]=e[n]}}}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}},{key:"accessibility",get:function o(){return this.get("accessibility",null)},set:function a(t){this.set("accessibility",t,Number,null)}},{key:"description",get:function s(){return this.get("description","")},set:function u(t){this.set("description",t,String,"")}},{key:"direction",get:function l(){return this.get("direction",null)},set:function c(t){this.set("direction",t,Number,null)}},{key:"maxfloors",get:function f(){return this.get("maxfloors",null)},set:function h(t){this.set("maxfloors",t,Number,null)}},{key:"metaData",get:function y(){return this.get("metaData","")},set:function v(t){this.set("metaData",t,String,"")}},{key:"pathTypeId",get:function p(){return this.get("pathTypeId",null)},set:function d(t){this.set("pathTypeId",t,Number,null)}},{key:"projectId",get:function g(){return this.get("projectId",null)},set:function m(t){this.set("projectId",t,Number,null)}},{key:"speed",get:function k(){return this.get("speed",null)},set:function b(t){this.set("speed",t,Number,null)}},{key:"typeName",get:function w(){return this.get("typeName","")},set:function I(t){this.set("typeName",t,String,"")}},{key:"typeidPK",get:function T(){return this.get("typeidPK",null)},set:function x(t){this.set("typeidPK",t,Number,null)}},{key:"weight",get:function _(){return this.get("weight",null)},set:function C(t){this.set("weight",t,Number,null)}}]);return t}();e.exports=o},{}],24:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./PathType");var a=function(){function t(){r(this,t);this._items=[]}i(t,[{key:"isPathType",value:function e(t){return t&&t.constructor===o}},{key:"create",value:function n(t){var e=null;if(t){if(t.constructor===Array){e=t.map(function(t){return new o(t)});this._items=this._items.concat(e)}else if(t.constructor===Object){e=new o(t);this._items.push(e)}}return e}},{key:"getAll",value:function a(){return this._items}},{key:"getByPathTypeId",value:function s(t){return this._items.find(function(e){return e.pathTypeId===t})||null}},{key:"getByTypeName",value:function u(t){if(t&&t.constructor===String){return this._items.find(function(e){return e.typeName.toLowerCase()===t.toLowerCase()})||null}else{return null}}},{key:"getByDirection",value:function l(t){return this._items.filter(function(e){return e.direction===t})}},{key:"sortByAccessibility",value:function c(){return this._items.sort(function(t,e){return t.accessibility<e.accessibility?1:e.accessibility<t.accessibility?-1:0})}},{key:"sortByWeight",value:function f(){return this._items.sort(function(t,e){return t.weight<e.weight?1:e.weight<t.weight?-1:0})}}]);return t}();e.exports=a},{"./PathType":23}],25:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("../Association/AssociationCollection");var a=function(){function t(e){r(this,t);this._={};this.AssociationCollection=new o;for(var n in e){if(e.hasOwnProperty(n)){if(n=="associations"){this.AssociationCollection.create(e[n])}else{this._[n]=e[n]}}}}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}},{key:"AssociationCollection",get:function a(){return this.get("AssociationCollection",null)},set:function s(t){this.set("AssociationCollection",t,o,null)}},{key:"decisionPoint",get:function u(){return this.get("decisionPoint",null)},set:function l(t){this.set("decisionPoint",t,Number,null)}},{key:"id",get:function c(){return this.get("id",null)},set:function f(t){this.set("id",t,Number,null)}},{key:"localId",get:function h(){return this.get("localId",null)},set:function y(t){this.set("localId",t,Number,null)}},{key:"mapId",get:function v(){return this.get("mapId",null)},set:function p(t){this.set("mapId",t,Number,null)}},{key:"status",get:function d(){return this.get("status",null)},set:function g(t){this.set("status",t,Number,null)}},{key:"x",get:function m(){return this.get("x",0)},set:function k(t){this.set("x",t,Number,0)}},{key:"y",get:function b(){return this.get("y",0)},set:function w(t){this.set("y",t,Number,0)}},{key:"point",get:function I(){return[this.x,this.y]}},{key:"zoneId",get:function T(){return this.get("zoneId",null)},set:function x(t){this.set("zoneId",t,Number,null)}}]);return t}();e.exports=a},{"../Association/AssociationCollection":6}],26:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./Waypoint");var a=function(){function t(){r(this,t);this._items=[]}i(t,[{key:"isWaypoint",value:function e(t){return t&&t.constructor===o}},{key:"create",value:function n(t){var e=null;if(t){if(t.constructor===Array){e=t.map(function(t){return new o(t)});this._items=this._items.concat(e)}else if(t.constructor===Object){e=new o(t);this._items.push(e)}}return e}},{key:"getAll",value:function a(){return this._items}},{key:"getById",value:function s(t){return this._items.find(function(e){return e.id===t})||null}},{key:"getByMapId",value:function u(t){return this._items.filter(function(e){return e.mapId===t})}},{key:"getByStatus",value:function l(t){return this._items.filter(function(e){return e.status===t})}},{key:"getByZoneId",value:function c(t){return this._items.filter(function(e){return e.zoneId===t})}}]);return t}();e.exports=a},{"./Waypoint":25}],27:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(e){r(this,t);this._={};for(var n in e){if(e.hasOwnProperty(n)){this._[n]=e[n]}}}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}},{key:"clientId",get:function o(){return this.get("clientId",null)},set:function a(t){this.set("clientId",t,String,null)}},{key:"projectId",get:function s(){return this.get("projectId",null)},set:function u(t){this.set("projectId",t,Number,null)}},{key:"statusCode",get:function l(){return this.get("statusCode",null)},set:function c(t){this.set("statusCode",t,Number,null)}},{key:"zoneId",get:function f(){return this.get("zoneId",null)},set:function h(t){this.set("zoneId",t,Number,null)}},{key:"zoneDetails",get:function y(){return this.get("zoneDetails",null)},set:function v(t){this.set("zoneDetails",t,Array,null)}}]);return t}();e.exports=o},{}],28:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./Zone");var a=function(){function t(){r(this,t);this._items=[]}i(t,[{key:"isZone",value:function e(t){return t&&t.constructor===o}},{key:"create",value:function n(t){var e=null;if(t){if(t.constructor===Array){e=t.map(function(t){return new o(t)});this._items=this._items.concat(e)}else if(t.constructor===Object){e=new o(t);this._items.push(e)}}return e}},{key:"getAll",value:function a(){return this._items}},{key:"getByClientId",value:function s(t){return this._items.filter(function(e){return e.clientId===t})}},{key:"getByZoneId",value:function u(t){return this._items.filter(function(e){return e.zoneId===t})}},{key:"getByStatusCode",value:function l(t){return this._items.filter(function(e){return e.statusCode===t})}}]);return t}();e.exports=a},{"./Zone":27}],29:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(){r(this,t)}i(t,[{key:"foldToBack",value:function e(t){if(!this.foldedPointsFront){this.foldedPointsFront=[]}if(!this.foldedPointsBack){this.foldedPointsBack=[]}this.foldedPointsBack.push(t)}},{key:"foldInFront",value:function n(t){if(!this.foldedPointsFront){this.foldedPointsFront=[]}if(!this.foldedPointsBack){this.foldedPointsBack=[]}this.foldedPointsFront.push(t)}}]);return t}();e.exports=o},{}],30:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./makeTextDirections");var a=t("./lineOfSight");var s=function l(t){r(this,l);var e=this;this.shapes={};t.MapCollection.getAll().forEach(function(t){e.shapes[t.mapId]={lboxes:t.lboxes}});this.model={getWaypointInformation:function n(e){return t.MapCollection.getWaypointByWaypointId(e)},getFloorBySequence:function i(e){return t.MapCollection.getByFloorSequence(e)},getFloorById:function s(e){return t.MapCollection.getByMapId(e)},getDestinationByWaypointId:function u(e){return t.DestinationCollection.getByWaypointId(e)},getWaypointsByDestinationId:function c(e){return t.MapCollection.getWaypointsByDestinationId(e)},destinations:t.DestinationCollection.getAll()};o(this);a(this)};var u=function(){function t(e){r(this,t);this.directionData={filter:true,UTurnInMeters:30,addTDifEmptyMeters:50};this.compiler=new s(e)}i(t,[{key:"compile",value:function e(t,n,i,r){if(!t||t.length===0){throw new TypeError("TextDirections :: pointArray must have length greater than zero.")}return this.compiler.makeTextDirections({pointArray:t,filter:n||this.directionData.filter,UTurnInMeters:i||this.directionData.UTurnInMeters,addTDifEmptyMeters:r||this.directionData.addTDifEmptyMeters})}}]);return t}();e.exports=u},{"./lineOfSight":38,"./makeTextDirections":39}],31:[function(t,e,n){"use strict";var i=t("../helpers");e.exports=function r(t){var e=t.textDirectionsFloorArray.length-1;var n=[];var r=[];var o=null;for(var a=1;a<e;a++){var s=t.textDirectionsFloorArray[a];if(!o||o.landmarkDestination.id!=s.landmarkDestination.id){if(n.length>1){var u="";var l="";var c=[];for(var f=0;f<n.length;f++){l=n[f];var h=r[f];var y=true;if(l.toLowerCase()==="Forward".toLowerCase()&&f<n.length-1){y=false}if(y){var v="";if(h==1){v=i.stringWithFormat("%",l)}else{v=i.stringWithFormat("% % times",l,h)}c.push({direction:l,amount:h});if(f!=n.length-1){v+=", then "}u+=v}}var p=i.stringWithFormat("With % on your %, go %.",o.landmarkDestination.name,o.directionToLandmark,u);c.shift();o.type="combo";o.secondaryDirections=c;o.output=p}n=[];r=[];o=s;n.push(o.direction);r.push(1)}else{var d=n[n.length-1];if(d.toLowerCase()===s.direction.toLowerCase()){if(s.direction.toLowerCase()!=="Forward".toLowerCase()){var g=r[r.length-1];g++;r.pop();r.push(g)}}else{n.push(s.direction);r.push(1)}o.foldInFront(s);t.textDirectionsFloorArray.splice(a,1);e--;a--}}}},{"../helpers":37}],32:[function(t,e,n){"use strict";var i=t("../helpers");e.exports=function r(t){if(t.enableDistanceFilters){if(t.addTDifEmptyMeters>0){var e=0;var n=null;var r=i.convertMetersToPixels(t.addTDifEmptyMeters,t.xScale);var o=0;var a=t.textDirectionsFloorArray[0];var s=[a.wp.x,a.wp.y];var u=t.textDirectionsFloorArray.length-1;for(var l=1;l<u;l++){var c=t.textDirectionsFloorArray[l];var f=[c.wp.x,c.wp.y];if(c.direction.toLowerCase()==="Forward".toLowerCase()){n=i.distanceBetween(s,f);if(n<r){a.foldInFront(c);t.textDirectionsFloorArray.splice(l,1);e++;u--;l--}else{s=[0,0];if(true){a=c;o=l;s=[a.wp.x,a.wp.y]}}}else if(a.direction.toLowerCase()==="Forward".toLowerCase()){n=i.distanceBetween(s,f);if(n<r){if(0!==o){c.foldToBack(a);t.textDirectionsFloorArray.splice(o,1);e++;u--}}a=c;o=l;s=[a.wp.x,a.wp.y]}else{if(true){a=c;o=l;s=[a.wp.x,a.wp.y]}}}}}}},{"../helpers":37}],33:[function(t,e,n){"use strict";var i=t("../helpers");e.exports=function r(t){if(t.enableDistanceFilters){if(t.addTDifEmptyMeters>0){var e=i.convertMetersToPixels(t.addTDifEmptyMeters,t.xScale);var n=t.textDirectionsFloorArray.length-1;for(var r=0;r<n;r++){var o=t.textDirectionsFloorArray[r];var a=t.textDirectionsFloorArray[r+1];var s;var u;var l;s=o;l=s.wp;var c=[l.x,l.y];var f;u=a;f=u.wp;var h=[f.x,f.y];var y=i.distanceBetween(c,h);var v=-1;var p=-1;var d=parseInt(y/e);if(d>1){v=(y-e*d)/d;p=e+v;for(var g=0;g<d-1;g++){var m=i.pointOnLineUsingDistanceFromStart(c,h,p);m=i.correctPointUsingWayfindPath(t.useArrayOfFloorWaypoints,m,0);var k={};k.floor=t.currentFloorTD.id;k.floorName=t.currentFloorTD.name;k.wp={x:m[0],y:m[1],mapId:t.currentFloorTD.id};k.direction=s.direction;var b=i.pointPairToBearingDegrees(c,m);k.angleToNext=b;var w=i.pointPairToBearingDegrees(m,h);k.angleToNextOfPreviousDirection=w;var I={value:null};var T=this.lineOfSightFromClosestLandmarkToXY(m,I,k.direction,k.angleToNextOfPreviousDirection,t.curCanvas);if(T){k.landmarkDestination=T;var x=this.model.getWaypointsByDestinationId(k.landmarkDestination.id);if(x.length){k.landmarkWP=x[0];var _=i.pointPairToBearingDegrees(m,I.value);k.angleToLandmark=_;var C=k.angleToNextOfPreviousDirection-k.angleToLandmark;while(C<-180){C+=360}while(C>180){C-=360}k.directionToLandmark=i.directionFromAngle(C,null)}}else{k.landmarkDestination=null;k.landmarkWP=null;k.angleToLandmark=-1}if(k.landmarkDestination){k.output=i.stringWithFormat("Continue Past %",k.landmarkDestination.name)}else{k.output="Continue Past"}k.type="continuepast";t.textDirectionsFloorArray.splice(r+1,0,k);n++;r++;c=m}}}}}}},{"../helpers":37}],34:[function(t,e,n){"use strict";e.exports=function i(t){if(t.useArrayOfFloorWaypoints==t.wayfindArray[t.wayfindArray.length-1]){var e=t.textDirectionsFloorArray[t.textDirectionsFloorArray.length-1];if(e&&e.destination){var n=false;var i=0;for(var r=0;r<t.textDirectionsFloorArray.length;r++){var o=t.textDirectionsFloorArray[r];if(o!=t.textDirectionsFloorArray[0]){if(o.landmarkDestination.id==e.destination.id){n=true;break}}i++}if(n){var a=t.textDirectionsFloorArray.length-1;for(r=a-1;r>=i;r--){var s=t.textDirectionsFloorArray[r];e.foldToBack(s);t.textDirectionsFloorArray.splice(r,1)}}}}}},{}],35:[function(t,e,n){"use strict";var i=t("../helpers");e.exports=function r(t){if(t.useArrayOfFloorWaypoints==t.wayfindArray[0]){var e=t.textDirectionsFloorArray.length-1;var n=t.textDirectionsFloorArray[0];for(var r=1;r<e;r++){var o=t.textDirectionsFloorArray[r];if(n.destination){if(o.landmarkDestination.id==n.destination.id){n.direction=o.direction;n.output=i.stringWithFormat("With % behind you, go %.",n.destination.name,n.direction);n.foldInFront(o);t.textDirectionsFloorArray.splice(r,1);break}}}}}},{"../helpers":37}],36:[function(t,e,n){"use strict";var i=t("../helpers");e.exports=function r(t){if(t.enableDistanceFilters){if(t.UTurnInMeters>0){if(t.useArrayOfFloorWaypoints!=t.wayfindArray[0]){var e=t.textDirectionsFloorArray[0];var n=t.useArrayOfFloorWaypoints.points[0];var r=n.edges.slice();var o=0;r.forEach(function(t){if(t.type==1){o++}});if(o!=1){return}if(t.textDirectionsFloorArray.length<4){return}var a=true;var s=t.textDirectionsFloorArray[1];var u=e.angleToNext-s.angleToNext;while(u<-180){u+=360}while(u>180){u-=360}if(u>=0){a=true}else{a=false}var l=95;var c=95;var f=2;var h=5;var y=5;if(l<Math.abs(u)){return}var v=true;if(u>=0){v=true}else{v=false}if(a!=v){return}var p=[e.wp.x,e.wp.y];var d=[s.wp.x,s.wp.y];var g=i.distanceBetween(p,d);var m=i.convertPixelsToMeters(g,t.xScale);if(m<=f){return}var k=t.textDirectionsFloorArray[2];var b=s.angleToNext-k.angleToNext;while(b<-180){b+=360}while(b>180){b-=360}if(c<Math.abs(b)){return}var w=true;if(b>=0){w=true}else{w=false}if(a!=w){return}var I=[k.wp.x,k.wp.y];var T=i.distanceBetween(d,I);var x=i.convertPixelsToMeters(T,t.xScale);if(x<=h){return}var _=t.textDirectionsFloorArray[3];var C=[_.wp.x,_.wp.y];var D=i.distanceBetween(I,C);var P=i.convertPixelsToMeters(D,t.xScale);if(y>=P){return}if(a){e.direction="Right"}else{e.direction="Left"}e.direction+=" UTurn";var A=i.stringWithFormat("With % on your %, make %.",e.landmarkDestination.name,e.directionToLandmark,e.direction);e.type="uturn";e.output=A;var M=e.distanceToNextPixels;M+=s.distanceToNextPixels;M+=k.distanceToNextPixels;e.distanceToNextPixels=M;e.distanceToNextMeters=i.convertPixelsToMeters(M,t.xScale);e.foldInFront(s);t.textDirectionsFloorArray.splice(1,1);e.foldInFront(k);t.textDirectionsFloorArray.splice(1,1)}}}}},{"../helpers":37}],37:[function(t,e,n){"use strict";var i={stringWithFormat:function r(){var t=[];var e=arguments[0].split("%");for(var n=1;n<arguments.length;n++){t.push(e[n-1]);t.push(arguments[n])}return t.join("")},landmarkDirectionFromDeltaAngle:function o(){},directionFromAngle:function a(t,e){var n=-25;var i=25;var r=25;var o=45;var a=45;var s=135;var u=135;var l=180;
var c=-45;var f=-25;var h=-135;var y=-45;var v=-180;var p=-135;if(e){void 0}var d="";if(n<=t&&t<=i){d="Forward"}else if(r<=t&&t<=o){d="Slight Right"}else if(a<=t&&t<=s){d="Right"}else if(c<=t&&t<=f){d="Slight Left"}else if(h<=t&&t<=y){d="Left"}else if(v<=t&&t<=p||u<=t&&t<=l){d="Back"}else{console.log("-directionFromAngle-\n","No coverage for angle difference:",t)}return d},returnDirectionToPoint:function s(t,e,n){var r=i.pointPairToBearingDegrees(t,e);var o=n-r;while(o<-180){o+=360}while(o>180){o-=360}var a=i.directionFromAngle(o,null);return a},isPointInsideRotatedRect:function u(t,e,n,r,o){if(i.triangleArea(e,n,t)>0||i.triangleArea(n,r,t)>0||i.triangleArea(r,o,t)>0||i.triangleArea(o,e,t)>0){return false}return true},triangleArea:function l(t,e,n){return n[0]*e[1]-e[0]*n[1]-(n[0]*t[1]-t[0]*n[1])+(e[0]*t[1]-t[0]*e[1])},doLineSegmentsIntersect:function c(t,e,n,i){var r=(e[0]-t[0])*(i[1]-n[1])-(e[1]-t[1])*(i[0]-n[0]);if(r===0){return false}var o=((n[0]-t[0])*(i[1]-n[1])-(n[1]-t[1])*(i[0]-n[0]))/r;var a=((n[0]-t[0])*(e[1]-t[1])-(n[1]-t[1])*(e[0]-t[0]))/r;if(o<0||o>1){return false}if(a<0||a>1){return false}return true},arrayOfRotatedPoints:function f(t){var e=0;if(t.transform&&t.transform.length>0){if(t.transform.indexOf("matrix(")>-1){var n=t.transform.split("matrix(").join("").split(")").join("");var r=n.split(" ");if(r.length>5){var o=parseFloat(r[0]),a=parseFloat(r[1]);e=Math.atan2(a,o)}}}var s=i.returnCenterOfRect(t);var u=[];var l=[t.x,t.y];u[0]=i.rotatePoint(l,s,e);var c=[t.x+t.width,t.y];u[1]=i.rotatePoint(c,s,e);var f=[t.x+t.width,t.y+t.height];u[2]=i.rotatePoint(f,s,e);var h=[t.x,t.y+t.height];u[3]=i.rotatePoint(h,s,e);return u},returnCenterOfRect:function h(t){var e=t.x+t.width/2;var n=t.y+t.height/2;return[e,n]},rotatePoint:function y(t,e,n){var i=t[0]-e[0];var r=t[1]-e[1];var o=i*Math.cos(n)-r*Math.sin(n);var a=i*Math.sin(n)+r*Math.cos(n);var s=o+e[0];var u=a+e[1];return[s,u]},distanceToLine:function v(t,e,n,r){return Math.sqrt(i.distToSegmentSquared(t,e,n,r))},distToSegmentSquared:function p(t,e,n,r){var o=i.dist2(e,n);if(o===0){r.value=n;return i.dist2(t,n)}var a=((t[0]-e[0])*(n[0]-e[0])+(t[1]-e[1])*(n[1]-e[1]))/o;if(a<0){r.value=e;return i.dist2(t,e)}if(a>1){r.value=n;return i.dist2(t,n)}r.value=[e[0]+a*(n[0]-e[0]),e[1]+a*(n[1]-e[1])];return i.dist2(t,r.value)},dist2:function d(t,e){return i.sqr(t[0]-e[0])+i.sqr(t[1]-e[1])},sqr:function g(t){return t*t},pointPairToBearingDegrees:function m(t,e){var n=[e[0]-t[0],e[1]-t[1]];var i;if(n[1]<0){i=Math.atan2(-n[1],n[0])}else{i=Math.atan2(n[1],-n[0])+Math.PI}return i*(180/Math.PI)},pointOnLineUsingDistanceFromStart:function k(t,e,n){var i=Math.atan2(e[1]-t[1],e[0]-t[0]);var r=t[0]+n*Math.cos(i);var o=t[1]+n*Math.sin(i);return[r,o]},distanceBetween:function b(t,e){var n=e[0]-t[0];var i=e[1]-t[1];return Math.sqrt(n*n+i*i)},stringContainsString:function w(t,e){return t.indexOf(e)>-1},convertMetersToPixels:function I(t,e){if(e===0){return-1}return t*1e3/e},convertPixelsToMeters:function T(t,e){if(e===0){return-1}return t*e/1e3},correctPointUsingWayfindPath:function x(t,e,n){var r=[0,0];var o=-1;for(var a=0;a<t.points.length-1;a++){var s=t.points[a];var u=[s.x,s.y];var l=t.points[a+1];var c=[l.x,l.y];var f={value:[0,0]};var h=i.distanceToLine(e,u,c,f);if(o==-1||h<o){o=h;r=f.value}}if(0<n){var y=r.x-e.x;var v=r.y-e.y;var p=Math.sqrt(i.sqr(y)+i.sqr(v));if(n<p){r=e}}return r}};e.exports=i},{}],38:[function(t,e,n){"use strict";var i=t("./helpers");e.exports=function(t){t.lineOfSightFromClosestLandmarkToXY=function(t,e,n,r,o){var a=null;var s=null;var u=[0,0];var l=-1;var c=null;var f=[0,0];var h=-1;var y=null;var v=[0,0];var p=-1;var d=null;var g=[0,0];var m=-1;var k=null;var b=[0,0];var w=-1;var I=null;var T=[0,0];var x=-1;var _=null;var C=o;for(var D=0;D<C.length;D++){var P=C[D];if(P){var A,M,N;if(P.parsed){A=P.parsed.unitId;M=P.parsed.lBoxFrame;N=P.parsed.rotatedPoints}else{var S=P.getAttribute("data-lbox");if(S)A=parseInt(S);M={x:parseFloat(P.getAttribute("x")),y:parseFloat(P.getAttribute("y")),width:parseFloat(P.getAttribute("width")),height:parseFloat(P.getAttribute("height")),transform:P.getAttribute("transform")};N=i.arrayOfRotatedPoints(M);P.parsed={unitId:A,lBoxFrame:M,rotatedPoints:N,dataLbox:S?S.split(","):[]}}if(!A)continue;var F={value:[0,0]};var B=false;var L=false;var W=false;var O=false;var j=false;var E=false;var q=-1;var R=-1;var z=-1;var U=-1;var Z=-1;var X=-1;var H=N[0];var G=N[1];var V=N[2];var Y=N[3];var K=i.distanceToLine(t,H,G,F);var J=i.returnDirectionToPoint(t,F.value,r);switch(J.toLowerCase()){case"forward":if(K<l||l==-1){if(q==-1||K<q){q=K;B=true;u=F.value}}break;case"left":if(K<p||p==-1){if(z==-1||K<z){z=K;W=true;v=F.value}}break;case"right":if(K<w||w==-1){if(Z==-1||K<Z){Z=K;j=true;b=F.value}}break;case"back":if(K<x||x==-1){if(X==-1||K<X){X=K;E=true;T=F.value}}break;case"slight right":if(K<m||m==-1){if(U==-1||K<U){U=K;O=true;g=F.value}}break;case"slight left":if(K<h||h==-1){if(R==-1||K<R){R=K;L=true;f=F.value}}break}K=i.distanceToLine(t,G,V,F);J=i.returnDirectionToPoint(t,F.value,r);switch(J.toLowerCase()){case"forward":if(K<l||l==-1){if(q==-1||K<q){q=K;B=true;u=F.value}}break;case"left":if(K<p||p==-1){if(z==-1||K<z){z=K;W=true;v=F.value}}break;case"right":if(K<w||w==-1){if(Z==-1||K<Z){Z=K;j=true;b=F.value}}break;case"back":if(K<x||x==-1){if(X==-1||K<X){X=K;E=true;T=F.value}}break;case"slight right":if(K<m||m==-1){if(U==-1||K<U){U=K;O=true;g=F.value}}break;case"slight left":if(K<h||h==-1){if(R==-1||K<R){R=K;L=true;f=F.value}}break}K=i.distanceToLine(t,V,Y,F);J=i.returnDirectionToPoint(t,F.value,r);switch(J.toLowerCase()){case"forward":if(K<l||l==-1){if(q==-1||K<q){q=K;B=true;u=F.value}}break;case"left":if(K<p||p==-1){if(z==-1||K<z){z=K;W=true;v=F.value}}break;case"right":if(K<w||w==-1){if(Z==-1||K<Z){Z=K;j=true;b=F.value}}break;case"back":if(K<x||x==-1){if(X==-1||K<X){X=K;E=true;T=F.value}}break;case"slight right":if(K<m||m==-1){if(U==-1||K<U){U=K;O=true;g=F.value}}break;case"slight left":if(K<h||h==-1){if(R==-1||K<R){R=K;L=true;f=F.value}}break}K=i.distanceToLine(t,H,Y,F);J=i.returnDirectionToPoint(t,F.value,r);switch(J.toLowerCase()){case"forward":if(K<l||l==-1){if(q==-1||K<q){q=K;B=true;u=F.value}}break;case"slight left":if(K<h||h==-1){if(R==-1||K<R){R=K;L=true;f=F.value}}break;case"left":if(K<p||p==-1){if(z==-1||K<z){z=K;W=true;v=F.value}}break;case"slight right":if(K<m||m==-1){if(U==-1||K<U){U=K;O=true;g=F.value}}break;case"right":if(K<w||w==-1){if(Z==-1||K<Z){Z=K;j=true;b=F.value}}break;case"back":if(K<x||x==-1){if(X==-1||K<X){X=K;E=true;T=F.value}}break}var Q=false;if(B||W||L||j||O||E){Q=this.lineOfSight(A,t,A,F.value,o)}if(B){if(Q){l=q;c=A}}if(W){if(Q){p=z;d=A}}if(L){if(Q){h=R;y=A}}if(j){if(Q){w=Z;I=A}}if(O){if(Q){m=U;k=A}}if(E){if(Q){x=X;_=A}}}}switch(n.toLowerCase()){case"forward":if(c){s=c;e.value=u}else if(y){s=y;e.value=f}else if(k){s=k;e.value=g}else if(d){s=d;e.value=v}else if(I){s=I;e.value=b}else if(_){s=_;e.value=T}else{void 0;console.log("Failed to find unit id for Forward")}if(l>h&&y){s=y;e.value=f;l=h}if(l>m&&k){s=k;e.value=g;l=m}if(l>p&&d){s=d;e.value=v;l=p}if(l>w&&I){s=I;e.value=b}break;case"left":if(d){s=d;e.value=v}else if(y){s=y;e.value=f}else if(c){s=c;e.value=u}else if(_){s=_;e.value=T}else if(I){s=I;e.value=b}else if(k){s=k;e.value=g}else{void 0;console.log("Failed to find unit id for Left")}if(p>l&&c){s=c;e.value=u;p=l}if(p>h&&y){s=y;e.value=f;p=h}break;case"right":if(I){s=I;e.value=b}else if(k){s=k;e.value=g}else if(c){s=c;e.value=u}else if(_){s=_;e.value=T}else if(d){s=d;e.value=v}else if(y){s=y;e.value=f}else{void 0;console.log("Failed to find unit id for Right")}if(w>l&&c){s=c;e.value=u;w=l}if(w>m&&k){s=k;e.value=g;w=m}break;case"back":if(_){s=_;e.value=T}if(I){s=I;e.value=b}else if(k){s=k;e.value=g}else if(d){s=d;e.value=v}else if(y){s=y;e.value=f}else if(c){s=c;e.value=u}else{void 0;console.log("Failed to find unit id for Back")}if(l>h&&y){s=y;e.value=f;l=h}if(l>m&&k){s=k;e.value=g;l=m}if(x>p&&d){s=d;e.value=v;l=p}if(x>w&&I){s=I;e.value=b}break;case"slight right":if(k){s=k;e.value=g}else if(I){s=I;e.value=b}else if(c){s=c;e.value=u}else if(_){s=_;e.value=T}else if(d){s=d;e.value=v}else if(y){s=y;e.value=f}else{void 0;console.log("Failed to find unit id for Slight Right")}if(m>l&&c){s=c;e.value=u;m=l}if(m>w&&I){s=I;e.value=b;m=w}break;case"slight left":if(y){s=y;e.value=f}else if(d){s=d;e.value=v}else if(c){s=c;e.value=u}else if(_){s=_;e.value=T}else if(I){s=I;e.value=b}else if(k){s=k;e.value=g}else{void 0;console.log("Failed to find unit id for Slight Left")}if(h>l&&c){s=c;e.value=u;h=l}if(h>p&&d){s=d;e.value=v;h=p}break}if(s){for(var $=0;$<this.model.destinations.length;$++){if(this.model.destinations[$].id==s){a=this.model.destinations[$];break}}}else{console.log("No final Unit Id")}return a};t.lineOfSight=function(t,e,n,r,o){var a=true;var s=o;for(var u=0;u<s.length;u++){var l=s[u];if(l){var c=l;var f,h,y,v;if(c.parsed){f=c.parsed.lBoxFrame;h=c.parsed.rotatedPoints;y=c.parsed.dataLbox}else{f={x:parseFloat(c.getAttribute("x")),y:parseFloat(c.getAttribute("y")),width:parseFloat(c.getAttribute("width")),height:parseFloat(c.getAttribute("height")),transform:c.getAttribute("transform")};h=i.arrayOfRotatedPoints(f);v=c.getAttribute("data-lbox");y=v?v.split(","):[];c.parsed={unitId:v?parseInt(v):null,lBoxFrame:f,rotatedPoints:h,dataLbox:y}}if(c){if(h.length===0){h=i.arrayOfRotatedPoints(f)}var p=h[0];var d=h[1];var g=h[2];var m=h[3];var k=true;y.forEach(function(e){if(e==t)k=false});if(k){if(y.length===0){if(i.isPointInsideRotatedRect(e,p,d,g,m)){continue}}var b=i.doLineSegmentsIntersect(e,r,p,d);if(b===false){var w=i.doLineSegmentsIntersect(e,r,d,g);if(w===false){var I=i.doLineSegmentsIntersect(e,r,g,m);if(I===false){var T=i.doLineSegmentsIntersect(e,r,m,p);if(T===false){void 0}else{return false}}else{return false}}else{return false}}else{return false}}}}}return a}}},{"./helpers":37}],39:[function(t,e,n){"use strict";var i=t("./helpers");var r=t("./filter/end-as-landmark");var o=t("./filter/start-as-landmark");var a=t("./filter/uturn");var s=t("./filter/consecutive-forwards");var u=t("./filter/combo-directions");var l=t("./filter/continue-past");var c=t("./Instruction");e.exports=function(t){t.makeTextDirections=function(t){console.time("makeTextDirections");var e=t.pointArray;var n=t.filter;var c=t.UTurnInMeters;var f=t.addTDifEmptyMeters;if(e.length===0){throw"!";return null}var h=[];var y=null;var v=-1;var p=null;for(var d=0;d<e.length;d++){var g=e[d];var m=[];if(p){if(p!=g){continue}}p=null;y=g.points[0];if(y){var k=this.model.getFloorById(y.mapId);var b=this.shapes[y.mapId].lboxes;if(k.mapId==y.mapId){var w=null;if(g.points.length>1){w=g.points[1]}var I=this.makeTextDirectionInstruction(e,g,k,y,w,-1);v=I.angleToNext;var T="";var x=false;if(d===0){if(I.destination){T=I.destination.name}else{if(I.landmarkDestination){T=I.landmarkDestination.name;x=true}else{T="Nearest Destination"}}}else if(y.usedEdgeTypeId==1){T=I.destination.name}else{T="Mover";var _=this.model.getWaypointInformation(y.parent.id);for(var C=0;C<e.length;C++){var D=e[C];var P=D.points[0];if(P){if(_.mapId==P.mapId){T=D.mover?D.mover.typeName:"Mover";break}}}}if(x){I.output=i.stringWithFormat("With % on your %, go %.",T,I.directionToLandmark,I.direction)}else{I.output=i.stringWithFormat("With % behind you, go %.",T,I.direction)}I.type="orientation";m.push(I);for(var A=1;A<g.points.length-1;A++){var M=g.points[A];w=g.points[A+1];I=this.makeTextDirectionInstruction(e,g,k,M,w,v);v=I.angleToNext;if(I.landmarkDestination){I.output=i.stringWithFormat("With % on your %, go %.",I.landmarkDestination.name,I.directionToLandmark,I.direction);I.type="orientation";m.push(I)}}var N=g.points[g.points.length-1];if(N){I=this.makeTextDirectionInstruction(e,g,k,N,null,v);var S="";if(!g.mover||g.mover.pathTypeId==1){void 0;var F=I.destination;I.type="end";S=i.stringWithFormat("Arrive at %.",F?F.name:"destination")}else{var B=g.mover.typeName;var L=e[d+1];var W="";var O=null;if(L){O=L.seq}if(O>g.seq){I.direction="Up"}else if(O<g.seq){I.direction="Down"}else{I.direction="Unknown Mover Direction"}var j=e.indexOf(g);var E=N.id;var q=g.seq;var R=true;while(R){j++;if(e.length>j&&j>=0){var z=e[j];var U=z.points;var Z=U[0];var X=U[U.length-1];if(E==Z.parent.id){q=z.seq;p=z;if(Z.id==X.id){E=X.id}else{R=false}}else{R=false}}else{R=false}}var H=this.model.getFloorBySequence(q);W=H.name;I.type="mover";I.moverType=B;S=i.stringWithFormat("Take % %, to %",B,I.direction,W)}I.output=S;I.angleToNext=-1;m.push(I)}}else{return null}if(n){var G=this.model.getFloorById(g.mapId);var V=G.xScale;var Y=G.yScale;var K=V>0&&Y>0;var J={textDirectionsFloorArray:m,useArrayOfFloorWaypoints:g,wayfindArray:e,filterOn:n,addTDifEmptyMeters:f,UTurnInMeters:c,enableDistanceFilters:K,xScale:V,yScale:Y,currentFloorTD:G,curCanvas:b};if(true){r.call(this,J)}if(true){o.call(this,J)}if(true){a.call(this,J)}if(true){s.call(this,J)}if(true){u.call(this,J)}if(true){l.call(this,J)}}var Q=m.length-1;for(var $=1;$<Q;$++){var tt=m[$];tt.output=this.languageFilters(tt.output)}h.push(m)}}for(var et=0;et<h.length;et++){var nt=h[et];var it=e[et];var rt=this.model.getFloorById(it.mapId);var ot=rt.xScale;var at=rt.yScale;var st=ot>0&&at>0;var ut=0;for(var lt=1;lt<nt.length;lt++){var ct=nt[lt];var ft=nt[lt-1];var ht=[ct.wp.x,ct.wp.y];var yt=[ft.wp.x,ft.wp.y];var vt=i.distanceBetween(yt,ht);ut+=vt;ct.distanceFromStartPixels=ut;ft.distanceToNextPixels=vt;if(st){ct.distanceFromStartMeters=i.convertPixelsToMeters(ct.distanceFromStartPixels,ot);ft.distanceToNextMeters=i.convertPixelsToMeters(ft.distanceToNextPixels,ot)}yt=ht}}console.timeEnd("makeTextDirections");return h};t.makeTextDirectionInstruction=function(t,e,n,r,o,a){var s=new c;s.floor=n.mapId;s.floorName=n.description;s.wp=this.model.getWaypointInformation(r.id);if(s.wp===null){return null}var u=this.model.getDestinationByWaypointId(r.id);if(u.length===0){void 0}else{s.destination=u[0]}var l=[r.x,r.y];var f;if(o===null){f=l}else{f=[o.x,o.y]}var h=i.pointPairToBearingDegrees(l,f);s.angleToNext=h;if(a==-1){s.angleToNextOfPreviousDirection=h}else{s.angleToNextOfPreviousDirection=a}var y=s.angleToNextOfPreviousDirection-s.angleToNext;while(y<-180){y+=360}while(y>180){y-=360}s.direction=i.directionFromAngle(y,null);var v=null;var p={value:null};var d=this.shapes[n.mapId].lboxes;v=this.lineOfSightFromClosestLandmarkToXY(l,p,s.direction,s.angleToNextOfPreviousDirection,d);if(v){s.landmarkDestination=v;var g=this.model.getWaypointsByDestinationId(s.landmarkDestination.id)[0];if(g){s.landmarkWP=g;h=i.pointPairToBearingDegrees(l,p.value);s.angleToLandmark=h;var m=s.angleToNextOfPreviousDirection-s.angleToLandmark;while(m<-180){m+=360}while(m>180){m-=360}s.directionToLandmark=i.directionFromAngle(m,null)}}else{s.landmarkDestination=null;s.landmarkWP=null;s.angleToLandmark=-1;console.log("No Landmark Destination.")}return s};t.languageFilters=function(t){if(i.stringContainsString(t,"on your Forward")){t=t.split("on your Forward").join("in front")}if(i.stringContainsString(t,"on your Back")){t=t.split("on your Back").join("behind you")}if(i.stringContainsString(t,"go Right")){t=t.split("go Right").join("turn Right")}if(i.stringContainsString(t,"go Left")){t=t.split("go Left").join("turn Left")}return t}}},{"./Instruction":29,"./filter/combo-directions":31,"./filter/consecutive-forwards":32,"./filter/continue-past":33,"./filter/end-as-landmark":34,"./filter/start-as-landmark":35,"./filter/uturn":36,"./helpers":37}],40:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(){r(this,t)}i(t,[{key:"decodeEntities",value:function e(t){try{if(!this.elementDecoder)this.elementDecoder=document.createElement("div");if(t&&typeof t==="string"){var e=this.elementDecoder;t=t.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,"");t=t.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,"");e.innerHTML=t;t=e.textContent;e.textContent="";return t}return t}catch(n){throw new Error("Utility :: Cannot Decode HTML entites outside of browser")}}},{key:"getScaleFromMatrix",value:function n(t){if(!t||t.constructor!==String)return 1;var e=undefined,n=undefined;e=t.split("(")[1].split(")")[0].split(" ");n=parseFloat(e[0]);return n}},{key:"getRotationFromMatrix",value:function o(t){if(!t||t.constructor!==String)return 0;var e=undefined,n=undefined,i=undefined;e=t.split("(")[1].split(")")[0].split(" ");n=parseFloat(e[0]);i=parseFloat(e[1]);return Math.round(Math.atan2(i,n)*(180/Math.PI))}},{key:"getDistanceBetweenTwoPoints",value:function a(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}},{key:"getObjectsInArrayByString",value:function s(t,e,n,i){e=e.trim();if(e==="")return[];var r=[];var o=[];if(!n)n=[];if(!i)i=5;function a(t,e,i){var r=0;var o=new RegExp(i.toLowerCase());var a=t[e].toLowerCase().search(o);if(a<0)return 0;else r++;if(a===0)r++;var s=1-a/t[e].length;r+=s;var u=i.length/t[e].length;r+=u;n.forEach(function(t){if(e.toLowerCase()===t.toLowerCase())r++;if(a===0)r++});if(e==="sponsoredRating")r+=t[e]/100;return r}t.forEach(function(t){var n=0;for(var i in t){if(!t.hasOwnProperty(i))continue;if(typeof t[i]!="string")continue;n+=a(t,i,e);var r=e.split(" ");if(r.length>1){for(var s=0;s<r.length;s++){n+=a(t,i,r[s])}}}if(n>0){o.push({score:n,item:t})}});o.sort(function(t,e){if(t.score>e.score){return-1}if(t.score<e.score){return 1}return 0});for(var s=0;s<o.length;s++){if(s===i)break;r.push(o[s].item)}return r}}]);return t}();e.exports=o},{}],41:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var r=function o(t,e,n,r,a,s,u){i(this,o);this.id=t;this.nodes=e;this.type=n;this.cost=r;this.acc=a;this.speed=s;this.direction=u};e.exports=r},{}],42:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./AS_Node.js");var a=t("./AS_Edge.js");var s=function(){function t(e,n,i,a){r(this,t);var s={verticalScale:100};this.waypoints=e;this.paths=n;this.pathTypes=i;this.maps=a;this.verticalScale=s.verticalScale;this.moverTypes=[];this.nodes=[];this.edges=[];for(var u=0;u<e.length;u++){var l=this.generateEdges(e[u].id);var c=this.generateNeighbors(e[u].id,l);var f=new o(e[u].id,e[u].x,e[u].y,this.getMapZValue(this.waypoints[u].mapId),this.waypoints[u].decisionPoint,this.waypoints[u].mapId,l,c);this.nodes.push(f)}for(var u=0;u<this.pathTypes.length;u++){if(this.pathTypes[u].pathTypeId!=1){var h="";if(this.pathTypes[u].pathtypeUri&&this.pathTypes[u].pathtypeUri[0])h=this.pathTypes[u].pathtypeUri[0].uri;var y={moverId:this.pathTypes[u].pathTypeId,speed:this.pathTypes[u].speed,maxFloors:this.pathTypes[u].maxfloors,imagePath:h,accessiblity:this.pathTypes[u].accessibility,typeName:this.pathTypes[u].typeName};this.moverTypes.push(y)}}}i(t,[{key:"getPathsWithWaypoint",value:function e(t){var e=[];for(var n=0;n<this.paths.length;n++){for(var i=0;i<this.paths[n].waypoints.length;i++){if(this.paths[n].waypoints[i]==t){e.push(this.paths[n])}}}return e}},{key:"getPathTypeById",value:function n(t){for(var e=0;e<this.pathTypes.length;e++){if(this.pathTypes[e].pathTypeId==t){return this.pathTypes[e]}}return null}},{key:"getWPById",value:function s(t){for(var e=0;e<this.waypoints.length;e++){if(this.waypoints[e].id==t)return this.waypoints[e]}}},{key:"generateEdges",value:function u(t){var e=this.getPathsWithWaypoint(t);var n=[];for(var i=0;i<e.length;i++){if(e[i].status!==0){var r=this.getPathTypeById(e[i].type);var o=new a(e[i].id,e[i].waypoints,e[i].type,r.weight,r.accessibility,r.speed,e[i].direction);n.push(o)}}return n}},{key:"generateNeighbors",value:function l(t,e){var n=[];var i=this.getWPById(t);var r={x:i.x,y:i.y,z:this.getMapZValue(i.mapId)};for(var o=0;o<e.length;o++){var a=e[o];for(var s=0;s<a.nodes.length;s++){if(a.nodes[s]==t)continue;var u=this.getWPById(a.nodes[s]);var l={x:u.x,y:u.y,z:this.getMapZValue(u.mapId)};var c=this.heuristic(l,r);var f=1;if(r.z==l.z){f=this.getFloorPreferenceMultiplier(u.mapId)}else{if(a.direction!==0){if(a.direction==1){if(r.z>l.z)continue}else if(a.direction==2){if(r.z<l.z)continue}}}var h=c*a.cost*f*(Math.abs(l.z-r.z)/a.speed+1);var y={id:u.id,cost:h,acc:a.acc,edgeId:a.id,edgeTypeId:a.type,distance:c,x:u.x,y:u.y,z:this.getMapZValue(u.mapId)};n.push(y)}}return n}},{key:"getFloorPreferenceMultiplier",value:function c(t){var e=1;if(this.maps){for(var n=0;n<this.maps.length;n++){if(this.maps[n].mapId==t){if(!this.maps[n].preference)break;if(this.maps[n].preference===0){e=1}else if(this.maps[n].preference>0){e=e/(this.maps[n].preference+1)}else if(this.maps[n].preference<0){e=e*(Math.abs(this.maps[n].preference)+1)}break}}}return e}},{key:"getMapZValue",value:function f(t){for(var e=0;e<this.maps.length;e++){if(this.maps[e].mapId==t){return this.maps[e].floorSequence*this.verticalScale}}return null}},{key:"heuristic",value:function h(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2))}}]);return t}();e.exports=s},{"./AS_Edge.js":41,"./AS_Node.js":43}],43:[function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var r=function o(t,e,n,r,a,s,u,l){i(this,o);this.id=t;this.x=e;this.y=n;this.z=r;this.decisionPoint=a;this.mapId=s;this.edges=u;this.f=0;this.g=0;this.h=0;this.visited=false;this.closed=false;this.parent=null;this.neighbors=l;this.usedEdgeTypeId=null};e.exports=r},{}],44:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./BinaryHeap");var a=t("./AS_Grid");var s=t("./WayfinderData");var u=function(){function t(e,n,i,o){r(this,t);this.grid=new a(e,n,i,o)}i(t,[{key:"search",value:function e(t,n,i){this.cleanGrid();var r=this.getNodeById(t);var o=this.getNodeById(n);var a=this.getHeap();r.h=0;a.push(r);while(a.size()>0){var s=a.pop();if(s===o){return this.pathTo(s,r)}s.closed=true;var u=this.getNeighbors(s);for(var l=0,c=u.length;l<c;++l){var f=u[l];var h=this.getNeighborNodeObject(f.id);if(f.acc>i){continue}var y=0;if(h.closed){continue}var v=s.g+this.getNeighborCost(f);var p=h.visited;if(!p||v+y<h.f){h.visited=true;h.parent=s;h.h=y;h.g=v;h.f=h.g+y;h.usedEdgeTypeId=f.edgeTypeId;if(!p){a.push(h)}else{a.rescoreElement(h)}}}}return[]}},{key:"cleanNode",value:function n(t){t.f=0;t.g=0;t.h=0;t.visited=false;t.closed=false;t.parent=null;t.usedEdgeTypeId=null}},{key:"cleanGrid",value:function u(){for(var t=0;t<this.grid.nodes.length;t++){this.cleanNode(this.grid.nodes[t])}}},{key:"getNodeById",value:function l(t){for(var e=0;e<this.grid.nodes.length;e++){if(t==this.grid.nodes[e].id)return this.grid.nodes[e]}}},{key:"getHeap",value:function c(){return new o(function(t){return t.f})}},{key:"pathTo",value:function f(t,e){var n=t,i=[];while(n.parent){i.push(n);n=n.parent}i.push(e);i=i.reverse();var r=[];var o=[];var a=-1;for(var u=0;u<i.length;u++){if(u===0){a=i[u].mapId}if(i[u].mapId!=a){var l=new s({seq:i[u-1].z/this.grid.verticalScale,mapId:a,mover:this.getPathTypeById(i[u].usedEdgeTypeId),points:o.slice(0),cost:i[u].f});r.push(l);o=[];a=i[u].mapId}o.push(i[u]);if(u==i.length-1){var l=new s({seq:i[u].z/this.grid.verticalScale,mapId:a,mover:this.getPathTypeById(i[u].usedEdgeTypeId),points:o,cost:i[u].f});r.push(l)}}return r}},{key:"getNeighbors",value:function h(t){return t.neighbors}},{key:"getNeighborNodeObject",value:function y(t){for(var e=0;e<this.grid.nodes.length;e++){if(t==this.grid.nodes[e].id)return this.grid.nodes[e]}}},{key:"getNeighborCost",value:function v(t){return t.cost}},{key:"getPathTypeById",value:function p(t){for(var e=0;e<this.grid.moverTypes.length;e++){if(this.grid.moverTypes[e].moverId==t)return this.grid.moverTypes[e]}return null}},{key:"heuristic",value:function d(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)+Math.abs(t.z-e.z)}}]);return t}();e.exports=u},{"./AS_Grid":42,"./BinaryHeap":45,"./WayfinderData":47}],45:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(e){r(this,t);this.content=[];this.scoreFunction=e}i(t,[{key:"push",value:function e(t){this.content.push(t);this.sinkDown(this.content.length-1)}},{key:"pop",value:function n(){var t=this.content[0];var e=this.content.pop();if(this.content.length>0){this.content[0]=e;this.bubbleUp(0)}return t}},{key:"remove",value:function o(t){var e=this.content.indexOf(t);var n=this.content.pop();if(e!==this.content.length-1){this.content[e]=n;if(this.scoreFunction(n)<this.scoreFunction(t)){this.sinkDown(e)}else{this.bubbleUp(e)}}}},{key:"size",value:function a(){return this.content.length}},{key:"rescoreElement",value:function s(t){this.sinkDown(this.content.indexOf(t))}},{key:"sinkDown",value:function u(t){var e=this.content[t];while(t>0){var n=(t+1>>1)-1,i=this.content[n];if(this.scoreFunction(e)<this.scoreFunction(i)){this.content[n]=e;this.content[t]=i;t=n}else{break}}}},{key:"bubbleUp",value:function l(t){var e=this.content.length,n=this.content[t],i=this.scoreFunction(n);while(true){var r=t+1<<1,o=r-1;var a=null,s=undefined;if(o<e){var u=this.content[o];s=this.scoreFunction(u);if(s<i){a=o}}if(r<e){var l=this.content[r],c=this.scoreFunction(l);if(c<(a===null?i:s)){a=r}}if(a!==null){this.content[t]=this.content[a];this.content[a]=n;t=a}else{break}}}}]);return t}();e.exports=o},{}],46:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=t("./AS_Search");var a=t("../models/Waypoint/Waypoint");var s=function(){function t(e){r(this,t);var n=e.MapCollection.getAllWaypoints();var i=e.PathCollection.getAll();var a=e.PathTypeCollection.getAll();var s=e.MapCollection.getAll();this._={astar:new o(n,i,a,s)}}i(t,[{key:"convertPointsToSVGPathData",value:function e(t){var e="";var n=t.length;if(n<2){return null}e+="M "+t[0].x+" "+t[0].y;for(var i=1;i<n;i++){e+=" L "+t[i].x+" "+t[i].y}return e}},{key:"search",value:function n(t,e,i){var r=100;if(i)r=50;if(t&&e&&t.constructor===a&&e.constructor===a){return this._.astar.search(t.id,e.id,r)}else{throw new TypeError("Wayfinder :: First two arguments must be Waypoints")}}}]);return t}();e.exports=s},{"../models/Waypoint/Waypoint":25,"./AS_Search":44}],47:[function(t,e,n){"use strict";var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||false;i.configurable=true;if("value"in i)i.writable=true;Object.defineProperty(t,i.key,i)}}return function(e,n,i){if(n)t(e.prototype,n);if(i)t(e,i);return e}}();function r(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}}var o=function(){function t(e){r(this,t);this._={};this._.seq=e.seq;this._.mapId=e.mapId;this._.mover=e.mover;this._.points=e.points;this._.cost=e.cost}i(t,[{key:"get",value:function e(t,n){return this._[t]!==undefined?this._[t]:n}},{key:"set",value:function n(t,e,i,r){if(e.constructor===i){this._[t]=e}else{this._[t]=r}}},{key:"seq",get:function o(){return this.get("seq",null)},set:function a(t){this.set("seq",t,Number,null)}},{key:"mapId",get:function s(){return this.get("mapId",null)},set:function u(t){this.set("mapId",t,Number,null)}},{key:"mover",get:function l(){return this.get("mover",null)},set:function c(t){this.set("mover",t,Object,null)}},{key:"points",get:function f(){return this.get("points",[])},set:function h(t){this.set("points",t,Array,[])}},{key:"cost",get:function y(){return this.get("cost",null)},set:function v(t){this.set("cost",t,Number,null)}}]);return t}();e.exports=o},{}]},{},[2]);